{% extends 'Home/index2.html' %}
{% block contenido_index %}
    {% load productosTags %}
    <div class="modal fade bs-example-modal-lg" id="agregar" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Productos</h4>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="x_panel">
                        <div class="x_content">
                            <div class="col-md-12 col-sm-12">
                                <table class="table table-bordered table-striped" id="tproductos"
                                       style="text-align: center">
                                    <thead>
                                    <tr style="background-color: #2A3F54; color: whitesmoke">
                                        <th>Id</th>
                                        <th>Detalle del Producto</th>
                                        <th>Stock</th>
                                        <th>Precio</th>
                                        <th>Seleccionar</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    {% for producto in productos %}
                                        <tr>
                                            <td>{{ producto.id }}</td>
                                            <td style="text-align: justify">{{ producto.nombre }}</td>
                                            <td>{% stock producto.id %}</td>
                                            <td>{% precioProducto producto.id %}</td>
                                            <td>
                                                <a href="#" data-dismiss="modal" onclick="agregarFila('{{ producto.id }}','{{ producto.nombre }}','{% precioProducto producto.id %}','{% stock producto.id %}')">
                                                    <i class="fa fa-check-circle text-success" style="font-size: 20px"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="x_panel">
                <div class="x_title">
                    <h2>PROFORMAS</h2>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">

                    <section class="content invoice" style="padding: 20px">
                        <!-- title row -->
                        <!-- info row -->
                        <img class="img-thumbnail" src="/media/{{ establecimiento.banner }}" style="width: 100%" alt="">
                        <div class="row invoice-info" style="padding-top: 10px">
                            <div class="col-sm-4 invoice-col">
                                {% if establecimientos %}
                                    Seleccione el Establecimiento
                                {% endif %}
                                <address>
                                    {% for establecimiento in establecimientos %}
                                        <a class="btn btn-success"
                                           href="/proforms/{{ establecimiento.id }}">{{ establecimiento }}</a>
                                    {% endfor %}
                                    {% if establecimiento %}
                                        <br>
                                        <span style="font-size: 30px; font-weight: bold">{{ establecimiento.nombreComercial|upper }}</span>
                                        <br><span style="font-weight: bold">R.U.C.:</span>{{ establecimiento.ruc }}
                                    {% endif %}
                                    {% for direccion in establecimiento.direccion_set.all %}
                                        <br><span style="font-weight: bold">Dirección:</span> {{ direccion.direccion }}
                                        <br><span style="font-weight: bold">Ciudad:</span>
                                        {{ direccion.ciudad.provincia }} - {{ direccion.ciudad }}
                                        <br><span style="font-weight: bold">Teléfono:</span> {{ direccion.telefono }}
                                    {% endfor %}

                                </address>
                            </div>
                            <!-- /.col -->
                            <div class="col-sm-4 invoice-col" style="padding-top: 20px">
                                <span style="font-weight: bold; font-size: 20px">A FAVOR DE:</span>
                                <address>
                                    <strong>Nombre: </strong> Nombre completo
                                    <br><strong>Dirección: </strong>Direccion del cliente
                                    <br><strong>Ciudad: </strong>Ciudad del Cliente
                                    <br><strong>Teléfono:: </strong>Telefono del cliente
                                </address>
                            </div>
                            <!-- /.col -->
                            <div class="col-sm-4 invoice-col" style="padding-top: 10px">
                                <br><strong>Fecha: </strong>
                                <br><span style="font-size: 20px; font-weight: bold">No.: <span
                                    style="color: indianred">00000000000000001</span></span>
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->

                        <!-- Table row -->
                        <div class="row">
                            <div class="table">
                                <table class="table table-striped table-bordered" id="tabla">
                                    <thead>
                                    <tr style="background-color: #2A3F54; color: whitesmoke">
                                        <th style="text-align: center">Código</th>
                                        <th style="width: 59%">Descripción</th>
                                        <th style="text-align: center">Cantidad</th>
                                        <th style="text-align: right">Precio</th>
                                        <th style="text-align: right">Subtotal</th>
                                        <th style="text-align: center">
                                            <a href="#" class="agregar" data-toggle="modal" data-target="#agregar">
                                                <i class="fa fa-plus-circle" style="font-size: 20px;color: whitesmoke"></i></a>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->

                        <div class="row">
                            <!-- accepted payments column -->
                            <div class="col-md-8">
                                <p class="text-muted well well-sm no-shadow" style="margin-top: 12px;">
                                    Los valores aquí expuestos pueden estar sujeto a cambios, Vigencia de la Proforma 1
                                    Mes.
                                </p>
                                <div class=" ">
                                    <button class="btn btn-danger pull-right" onclick="window.print();"><i
                                            class="fa fa-print"></i>
                                        Print
                                    </button>
                                    <button class="btn btn-success pull-right"><i class="fa fa-credit-card"></i> Submit
                                        Payment
                                    </button>
                                    <button class="btn btn-primary pull-right" style="margin-right: 5px;"><i
                                            class="fa fa-download"></i> Generate PDF
                                    </button>
                                </div>
                            </div>
                            <!-- /.col -->
                            <div class="col-md-4">
                                <div class="table-responsive">
                                    <table class="table">
                                        <tbody>
                                        <tr>
                                            <th style="width:75%">Subtotal:</th>
                                            <td>$0,00</td>
                                        </tr>
                                        <tr>
                                            <th>IVA (12%):</th>
                                            <td>$0,00</td>
                                        </tr>
                                        <tr>
                                            <th>Total:</th>
                                            <td>$0,00</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->

                        <!-- this row will not appear when printing -->
                        <div class="row no-print">

                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block script_index %}
    <script>
        function agregarFila(id, nombre, precio, stock) {
            if (parseInt(stock) > 0) {
                document.getElementById("tabla").insertRow(-1).innerHTML = '' +
                    '<td>' + id + '</td>' +
                    '<td>' + nombre + '</td>' +
                    '<td style="text-align: center;"><input min="1" max="' + stock + '" class="form-control" style="text-align: center" value="1" type="number"/></td>' +
                    '<td style="text-align: right">' + precio + '</td>' +
                    '<td></td>' +
                    '<td style="text-align: center"><a href="#" class="eliminar" onclick="eliminarFila($(this))">' +
                    '<i class="fa fa-minus-circle text-danger" style="font-size: 20px"></i></a></td>';

            }
            else{
                alert("No hay stock")
            }
        }

        function eliminarFila(value) {
            $(value).parents('tr').eq(0).remove();
        }


    </script>
    <script>
        $(document).ready(function () {
            $("#tproductos").DataTable();
        });
    </script>
{% endblock %}